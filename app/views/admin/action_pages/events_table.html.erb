<% content_for(:nav) { render "action_page_nav" } %>
<h2>Action page analytics for: <em><%= @actionPage.title %></em></h3>

<div id="analytics-nav">
  <%= link_to "Table", admin_action_page_events_table_path(@actionPage), class: "btn sm active", target: "_blank" %>
  <%= link_to "Chart", admin_action_page_events_path(@actionPage), class: "btn sm", target: "_blank" %>
  <div class="analytics-filters">
    <h2>Filters</h2>
    <%= form_tag admin_action_page_events_table_path(@actionPage), method: :get do %>
      <div class="form-item">
        <%= label_tag "Date Range" %>
        <%= select_tag :date_range,
        options_for_select(["Last 7 days", "Last 30 days", "Last 3 months",
                            "Last 6 months", "Action lifetime"], params[:date_range]) %>
      </div>
      <div class="form-actions">
        <%= submit_tag "Filter", class: "btn btn-primary btn-sm", data: { disable_with: false } %>
      </div>
    <% end %>
  </div>
</div>

<table id="analytics-table" class="table striped">
  <thead>
    <tr>
      <th>Date</th>
      <th>Views</th>
      <th>Actions Taken</th>
      <th>%</th>
    </tr>
  </thead>

  <tbody>
    <% @data.each do |date, counts| %>
      <tr>
        <td><%= date %></td>
        <% @columns.each do |col| %>
          <td><%= counts[col] %></td>
        <% end %>
        <td>
          <% if counts[@columns[0]] > 0 %>
            <%= number_to_percentage(counts[@columns[1]] / counts[@columns[0]].to_f) %>
          <% else %>
            -
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>
