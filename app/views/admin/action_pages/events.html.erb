<% content_for(:nav) { render "action_page_nav" } %>

<h2>Analytics</h2>

<span class="alert alert-warning times-notification"><i class="icon-attention"></i> All dates and times are given in <%= Time.zone.name %></span>
<div id="analytics-nav">
  <%= link_to "Table", admin_action_page_events_table_path(@actionPage), class: "btn sm", target: "_blank" %>
  <%= link_to "Chart", admin_action_page_events_path(@actionPage), class: "btn sm active", target: "_blank" %>
  <div class="analytics-filters">
    <h2>Filters</h2>
    <%= form_tag admin_action_page_events_path(@actionPage), method: :get do %>
      <div class="form-item">
        <%= label_tag "Date Range" %>
        <%= select_tag :date_text,
        options_for_select(["Last 7 days", "Last 30 days", "Last 3 months",
                            "Last 6 months", "Action lifetime"], params[:date_text]) %>
        <input type="text" id="date_range" name="date_range_text" value="" />
      </div>
      <div class="form-actions">
        <%= submit_tag "Filter", class: "btn btn-primary btn-sm", data: { disable_with: false } %>
      </div>
    <% end %>
  </div>
</div>

<% if @actionPage.enable_congress_message? %>
  <p>Out of <%= @total %> total messages, <%= @customized %> were customized (<%= number_to_percentage(@percentage, precision: 2) %>).</p>
<% end %>

<% Ahoy::Event.action_types(@actionPage).each do |type| %>
  <h3><%= t(type, scope: :ahoy) %></h3>

  <% if type == :signatures %>
    <%= link_to "Download CSV", csv_admin_petition_path(@actionPage.petition), class: "btn" %>
    <%= link_to "View Signatures", admin_petition_path(@actionPage.petition), class: "btn" %>
  <% end %>

  <%= line_chart(admin_action_page_events_path(@actionPage, type: type), height: "200px", discrete: true) %>
<% end %>

<% if @actionPage.enable_congress_message? %>
  <h3>Congresss Messages Sent</h3>
  <%= link_to congress_tabulation_admin_congress_message_campaign_path(@actionPage.congress_message_campaign), target: "_blank" do %>
    <button type="button" class="btn btn-default btn-sm">Congressional Breakdown</button>
  <% end %>

  <%= line_chart(@actionPage.congress_message_campaign.date_fills_url(@start_date, @end_date), height: "200px") %>
<% end %>
